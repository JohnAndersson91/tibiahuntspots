<!DOCTYPE html>
<html>
<head>
  <title>Tibia Hunt Spots</title>
  <style>
    body { background-color: #1e1e1e; color: #eee; font-family: sans-serif; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #555; padding: 8px; text-align: left; }
    th { cursor: pointer; }
    input, button { margin: 5px; }
    img { max-width: 100px; max-height: 100px; }
  </style>
</head>
<body>

<h1>Tibia Hunt Spots</h1>

<!-- Table visible to everyone -->
<table id="spotsTable">
  <thead>
    <tr>
      <th>Spot</th>
      <th onclick="sortTable('level')">Level &#x25B2;&#x25BC;</th>
      <th onclick="sortTable('exp')">Raw Exp &#x25B2;&#x25BC;</th>
      <th onclick="sortTable('profit')">Profit &#x25B2;&#x25BC;</th>
      <th>Images</th>
    </tr>
  </thead>
  <tbody id="spotsBody"></tbody>
</table>

<!-- Admin panel only visible after login -->
<div id="adminPanel" style="display:none;">
  <h2>Manage Spots</h2>
  <input id="spotName" placeholder="Spot Name">
  <input id="level" placeholder="Level">
  <input id="suffix" placeholder="Suffix (optional)">
  <input id="exp" placeholder="Raw Exp">
  <input id="profit" placeholder="Profit">
  <input type="file" id="image1">
  <input type="file" id="image2">
  <button onclick="addSpot()">Add Spot</button>

  <h3>Backup / Restore</h3>
  <button onclick="downloadBackup()">Download Backup</button>
  <input type="file" id="restoreFile" onchange="restoreBackup(event)">
</div>

<!-- Login form -->
<div id="loginForm">
  <input type="password" id="passwordInput" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<script>
const PASSWORD = "willchange321"; // change this to your desired password
let spots = [];
let sortDirection = { level: true, exp: true, profit: true };

// Login function
function login() {
  const entered = document.getElementById("passwordInput").value;
  if (entered === PASSWORD) {
    document.getElementById("adminPanel").style.display = "block";
    document.getElementById("loginForm").style.display = "none";
  } else {
    alert("Wrong password!");
  }
}

// Add spot
function addSpot() {
  const name = document.getElementById("spotName").value;
  const level = parseInt(document.getElementById("level").value);
  const suffix = document.getElementById("suffix").value;
  const exp = parseInt(document.getElementById("exp").value);
  const profit = parseInt(document.getElementById("profit").value);

  const images = [];
  const img1 = document.getElementById("image1").files[0];
  const img2 = document.getElementById("image2").files[0];
  if(img1) images.push(URL.createObjectURL(img1));
  if(img2) images.push(URL.createObjectURL(img2));

  spots.push({ spot: name, level, suffix, exp, profit, images });
  renderTable();
}

// Render table
function renderTable() {
  const tbody = document.getElementById("spotsBody");
  tbody.innerHTML = "";
  spots.forEach(s => {
    const tr = document.createElement("tr");
    const imagesHTML = s.images.map(i => `<img src="${i}">`).join("");
    tr.innerHTML = `
      <td>${s.spot}</td>
      <td>${s.level}${s.suffix || ""}</td>
      <td>${s.exp}</td>
      <td>${s.profit}</td>
      <td>${imagesHTML}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Sort table
function sortTable(key) {
  spots.sort((a,b) => {
    if(sortDirection[key]) return a[key] - b[key];
    else return b[key] - a[key];
  });
  sortDirection[key] = !sortDirection[key];
  renderTable();
}

// Download backup
function downloadBackup() {
  const dataStr = JSON.stringify(spots, null, 2);
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "spots_backup.json";
  a.click();
  URL.revokeObjectURL(url);
}

// Restore backup
function restoreBackup(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (Array.isArray(data)) {
        spots = data;
        renderTable();
        alert("Backup restored successfully!");
      } else {
        alert("Invalid backup file.");
      }
    } catch(err) {
      alert("Error reading backup file.");
    }
  };
  reader.readAsText(file);
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunting Spots</title>
<style>
  body { background-color: #1e1e1e; color: #eee; font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; margin-bottom: 20px; width: 100%; }
  th, td { border: 1px solid #555; padding: 8px; text-align: left; }
  th { cursor: pointer; background-color: #333; }
  tr:nth-child(even) { background-color: #2a2a2a; }
  .tab { cursor: pointer; display: inline-block; padding: 10px; background: #333; margin-right: 5px; border-radius: 5px; }
  .tab.active { background: #555; }
  #manage { margin-top: 20px; padding: 10px; border: 1px solid #555; display: none; }
  input, button, select { margin: 5px 0; padding: 5px; }
  th .sort-arrow { margin-left: 5px; font-size: 0.8em; }
</style>
</head>
<body>

<h1>Hunting Spots</h1>

<!-- Tabs -->
<div id="tabs"></div>

<!-- Tables -->
<div id="tables"></div>

<!-- Login for management -->
<div id="login">
  <h3>Enter password to manage spots:</h3>
  <input type="password" id="passwordInput">
  <button onclick="checkPassword()">Enter</button>
</div>

<!-- Manage section -->
<div id="manage">
  <h3>Manage Spots</h3>
  <div>
    <label>Section: 
      <select id="newSection">
        <option value="knight">Knight</option>
        <option value="paladin">Paladin</option>
        <option value="mage">Mage</option>
        <option value="monk">Monk</option>
        <option value="duo">Duo</option>
      </select>
    </label><br>
    <input type="text" id="newSpot" placeholder="Spot name">
    <input type="number" id="newLevel" placeholder="Level">
    <input type="number" id="newExp" placeholder="Raw Exp">
    <input type="number" id="newProfit" placeholder="Profit">
    <input type="file" id="newImage1" accept="image/*">
    <input type="file" id="newImage2" accept="image/*">
    <button onclick="addSpot()">Add Spot</button>
  </div>
  <div>
    <button onclick="downloadBackup()">Download Backup</button>
    <input type="file" id="uploadBackup" accept=".json">
    <button onclick="uploadBackup()">Upload Backup</button>
  </div>
</div>

<script>
const PASSWORD = "willchange321"; // Change your password here

const SECTIONS = ["knight","paladin","mage","monk","duo"];
let activeSection = "knight";
let sortState = {}; // Track ascending/descending per section-column

let data = {
  knight: [],
  paladin: [],
  mage: [],
  monk: [],
  duo: []
};

// Tabs
const tabsDiv = document.getElementById("tabs");
SECTIONS.forEach(sec=>{
  const tab = document.createElement("div");
  tab.textContent = sec.charAt(0).toUpperCase() + sec.slice(1);
  tab.className = "tab";
  tab.onclick = ()=>{activeSection=sec; renderTables();}
  tabsDiv.appendChild(tab);
});

// Render tables
function renderTables(){
  document.querySelectorAll(".tab").forEach((t,i)=>t.classList.toggle("active", SECTIONS[i]===activeSection));
  const tablesDiv = document.getElementById("tables");
  tablesDiv.innerHTML = "";
  SECTIONS.forEach(sec=>{
    const sectionData = data[sec];
    const table = document.createElement("table");
    const th = document.createElement("tr");
    const headers = ["Hunting Spot","Level","Raw Exp","Profit","Images","Actions"];
    headers.forEach((h,i)=>{
      const thElem = document.createElement("th");
      thElem.textContent = h;
      if(i>0 && i<4){ // Make sortable
        thElem.onclick = ()=>sortSection(sec,h.toLowerCase().replace(/ /g,""));
        const arrowSpan = document.createElement("span");
        arrowSpan.className = "sort-arrow";
        if(sortState[sec] && sortState[sec].key===h.toLowerCase().replace(/ /g,"")){
          arrowSpan.textContent = sortState[sec].asc ? "▲" : "▼";
        }
        thElem.appendChild(arrowSpan);
      }
      th.appendChild(thElem);
    });
    table.appendChild(th);

    sectionData.forEach((s,index)=>{
      const tr = document.createElement("tr");
      const imagesHTML = s.images.map(img=> img ? `<img src="${img}" width="50">` : "").join("");
      const actionsHTML = document.getElementById("manage").style.display === "block" 
                          ? `<button onclick="removeSpot('${sec}',${index})">Remove</button>` 
                          : "";
      tr.innerHTML = `<td>${s.spot}</td>
                      <td>${s.level}</td>
                      <td>${s.exp}</td>
                      <td>${s.profit}</td>
                      <td>${imagesHTML}</td>
                      <td>${actionsHTML}</td>`;
      table.appendChild(tr);
    });
    const header = document.createElement("h2");
    header.textContent = sec.charAt(0).toUpperCase()+sec.slice(1);
    if(sec===activeSection){
      tablesDiv.appendChild(header);
      tablesDiv.appendChild(table);
    }
  });
}

// Sorting
function sortSection(section,key){
  const keyMap = {level:"level", rawexp:"exp", profit:"profit"};
  const dataKey = keyMap[key];
  if(!dataKey) return;

  // Toggle ascending/descending
  if(!sortState[section]) sortState[section] = {key,asc:false};
  if(sortState[section].key === key) sortState[section].asc = !sortState[section].asc;
  else sortState[section] = {key,asc:true};

  const asc = sortState[section].asc;
  data[section].sort((a,b)=>{
    return asc ? a[dataKey]-b[dataKey] : b[dataKey]-a[dataKey];
  });

  renderTables();
}

// Add spot
function addSpot(){
  const sec = document.getElementById("newSection").value;
  const spot = document.getElementById("newSpot").value;
  if(!spot) { alert("Spot name is required"); return; }
  const level = parseInt(document.getElementById("newLevel").value)||0;
  const exp = parseInt(document.getElementById("newExp").value)||0;
  const profit = parseInt(document.getElementById("newProfit").value)||0;

  const img1File = document.getElementById("newImage1").files[0];
  const img2File = document.getElementById("newImage2").files[0];

  let images = [];
  if(img1File) images.push(URL.createObjectURL(img1File));
  else images.push("");
  if(img2File) images.push(URL.createObjectURL(img2File));
  else images.push("");

  data[sec].push({spot,level,exp,profit,images});
  renderTables();

  document.getElementById("newSpot").value="";
  document.getElementById("newLevel").value="";
  document.getElementById("newExp").value="";
  document.getElementById("newProfit").value="";
  document.getElementById("newImage1").value="";
  document.getElementById("newImage2").value="";
}

// Remove spot
function removeSpot(section,index){
  if(confirm("Are you sure you want to remove this spot?")){
    data[section].splice(index,1);
    renderTables();
  }
}

// Password check
function checkPassword(){
  const input = document.getElementById("passwordInput").value;
  if(input === PASSWORD){
    document.getElementById("manage").style.display = "block";
    document.getElementById("login").style.display = "none";
    renderTables();
  } else {
    alert("Incorrect password");
  }
}

// Backup download
function downloadBackup() {
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "hunting_spots_backup.json";
  a.click();
  URL.revokeObjectURL(url);
}

// Backup upload
function uploadBackup() {
  const fileInput = document.getElementById("uploadBackup");
  const file = fileInput.files[0];
  if(!file) { alert("Select a JSON file first"); return; }

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const uploadedData = JSON.parse(e.target.result);
      SECTIONS.forEach(sec=>{
        if(!uploadedData[sec]) uploadedData[sec]=[];
      });
      data = uploadedData;
      renderTables();
      alert("Backup restored successfully!");
    } catch(err) {
      alert("Invalid JSON file");
    }
  }
  reader.readAsText(file);
}

// Initial render
renderTables();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tibia Hunt Spots</title>
<style>
  body { background:#1e1e1e; color:#f0f0f0; font-family:sans-serif; padding:20px; }
  table { width:100%; border-collapse: collapse; margin-top:20px; }
  th, td { border:1px solid #444; padding:8px; text-align:left; }
  th { cursor:pointer; user-select:none; }
  th .arrow { font-size:0.8em; margin-left:5px; color:#ffcc00; }
  #imageModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.8); justify-content:center; align-items:center; }
  #imageModal img { max-width:90%; max-height:90%; }
  img.thumb { max-width:50px; max-height:50px; margin:2px; cursor:pointer; }
  #imagePreview img { max-width:50px; max-height:50px; margin:2px; }
  #addSpotForm { margin-top:20px; display:flex; flex-direction:column; gap:5px; }
  input, button, select { padding:5px; border-radius:4px; border:none; }
  button { cursor:pointer; background:#555; color:#fff; }
  #backupBtn, #loadBackupBtn { margin-top:10px; }
</style>
</head>
<body>

<h1>Tibia Hunt Spots</h1>

<!-- Section Selector -->
<select id="sectionSelector">
  <option value="All">All Classes</option>
  <option value="Knight">Knight</option>
  <option value="Paladin">Paladin</option>
  <option value="Mages">Mages</option>
  <option value="Monk">Monk</option>
  <option value="Duo">Duo</option>
</select>

<!-- Spots Table -->
<table>
  <thead>
    <tr>
      <th>Spot</th>
      <th id="levelHeader">Level <span class="arrow"></span></th>
      <th id="expHeader">Raw Exp <span class="arrow"></span></th>
      <th id="profitHeader">Profit <span class="arrow"></span></th>
      <th>Images</th>
    </tr>
  </thead>
  <tbody id="spotsBody"></tbody>
</table>

<!-- Image Modal -->
<div id="imageModal">
  <img id="modalImg" src="">
</div>

<!-- Password -->
<div id="loginDiv">
  <input type="password" id="password" placeholder="Enter password to manage spots">
  <button onclick="checkPassword()">Login</button>
</div>

<!-- Add Spot Form -->
<div id="formDiv" style="display:none;">
  <form id="addSpotForm">
    <input type="text" id="spotName" placeholder="Spot Name" required>
    <select id="sectionSelect" required>
      <option value="" disabled selected>Select Class</option>
      <option value="Knight">Knight</option>
      <option value="Paladin">Paladin</option>
      <option value="Mages">Mages</option>
      <option value="Monk">Monk</option>
      <option value="Duo">Duo</option>
    </select>
    <input type="number" id="level" placeholder="Level" required>
    <input type="number" id="exp" placeholder="Raw Exp" required>
    <input type="number" id="profit" placeholder="Profit" required>
    <input type="file" id="images" multiple accept="image/*">
    <div id="imagePreview"></div>
    <button type="submit">Add Spot</button>
  </form>

  <!-- Backup and Load -->
  <button id="backupBtn">Save Backup</button>
  <input type="file" id="loadBackupInput" accept=".json">
  <button id="loadBackupBtn">Load Backup</button>
</div>

<script>
let spots = [];
let currentSection = 'All';
let sortState = {level:null, exp:null, profit:null}; // null=unsorted, true=asc, false=desc
const PASSWORD = "willchange321"; // change this

// Section filter
document.getElementById("sectionSelector").addEventListener("change", e=>{
  currentSection = e.target.value;
  renderTable();
});

// Render table
function renderTable() {
  const tbody = document.getElementById("spotsBody");
  tbody.innerHTML = "";
  spots.filter(s => currentSection==='All' || s.section===currentSection).forEach(s => {
    const tr = document.createElement("tr");
    const imagesHTML = s.images.map(i => `<img src="${i}" class="thumb" onclick="showImage('${i}')">`).join("");
    tr.innerHTML = `
      <td>${s.spot}</td>
      <td>${s.level}${s.suffix || ""}</td>
      <td>${s.exp}</td>
      <td>${s.profit}</td>
      <td>${imagesHTML}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Image modal
function showImage(src) {
  const modal = document.getElementById("imageModal");
  document.getElementById("modalImg").src = src;
  modal.style.display = "flex";
}
document.getElementById("imageModal").onclick = function(){ this.style.display="none"; }

// Sorting
function sortTable(key){
  // Toggle direction
  if(sortState[key] === null) sortState[key] = true;
  else sortState[key] = !sortState[key];

  spots.sort((a,b)=>{
    return sortState[key] ? a[key]-b[key] : b[key]-a[key];
  });

  // Update headers arrows
  ['level','exp','profit'].forEach(h=>{
    const arrowEl = document.querySelector("#"+h+"Header .arrow");
    arrowEl.textContent = "";
    if(h===key) arrowEl.textContent = sortState[key] ? "↑":"↓";
  });

  renderTable();
}
['level','exp','profit'].forEach(k=>document.getElementById(k+'Header').onclick=()=>sortTable(k));

// Password login
function checkPassword() {
  if(document.getElementById("password").value === PASSWORD){
    document.getElementById("formDiv").style.display = "block";
    document.getElementById("loginDiv").style.display = "none";
  } else {
    alert("Incorrect password");
  }
}

// Image preview
document.getElementById("images").addEventListener("change", function(){
  const preview = document.getElementById("imagePreview");
  preview.innerHTML = "";
  Array.from(this.files).forEach(file=>{
    const reader = new FileReader();
    reader.onload = function(e){
      const img = document.createElement("img");
      img.src = e.target.result;
      preview.appendChild(img);
    }
    reader.readAsDataURL(file);
  });
});

// Add spot
document.getElementById("addSpotForm").addEventListener("submit", function(e){
  e.preventDefault();
  const files = document.getElementById("images").files;
  const imagesArray = Array.from(files).map(f => URL.createObjectURL(f));
  spots.push({
    spot: document.getElementById("spotName").value,
    section: document.getElementById("sectionSelect").value,
    level: Number(document.getElementById("level").value),
    exp: Number(document.getElementById("exp").value),
    profit: Number(document.getElementById("profit").value),
    images: imagesArray
  });
  renderTable();
  this.reset();
  document.getElementById("imagePreview").innerHTML = "";
});

// Save Backup
document.getElementById("backupBtn").addEventListener("click", ()=>{
  const dataStr = JSON.stringify(spots, null, 2);
  const blob = new Blob([dataStr], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "tibia_hunt_spots_backup.json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});

// Load Backup
document.getElementById("loadBackupBtn").addEventListener("click", ()=>{
  const fileInput = document.getElementById("loadBackupInput");
  if(fileInput.files.length === 0){
    alert("Please select a JSON backup file first.");
    return;
  }
  const file = fileInput.files[0];
  const reader = new FileReader();
  reader.onload = function(e){
    try {
      const loadedSpots = JSON.parse(e.target.result);
      if(Array.isArray(loadedSpots)){
        spots = loadedSpots;
        renderTable();
        alert("Backup loaded successfully!");
      } else {
        alert("Invalid backup format.");
      }
    } catch(err){
      alert("Error reading backup: " + err);
    }
  };
  reader.readAsText(file);
});

renderTable();
</script>

</body>
</html>
